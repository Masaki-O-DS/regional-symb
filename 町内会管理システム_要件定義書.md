# 町内会管理システム 要件定義書

## 1. システム概要

### 1.1 システム目的
地域コミュニティ（町内会）の運営を効率化し、住民間の情報共有とコミュニケーションを促進するWebベースの管理システム

### 1.2 システム名称
タウンリンク（TownLink）

### 1.3 対象ユーザー
- 町内会役員（管理者権限）
- 町内会住民（一般ユーザー）

## 2. 技術アーキテクチャ

### 2.1 フロントエンド
- **フレームワーク**: Streamlit
- **プログラミング言語**: Python
- **UI構成**: マルチページアプリケーション（サイドバーナビゲーション）

### 2.2 データストレージ
- **形式**: JSON ファイル
- **場所**: `backend/app/db/` ディレクトリ
- **特徴**: API サーバー不要のファイルベースストレージ

### 2.3 データ管理
- **CRUD操作**: `frontend/modules/func.py` で統一管理
- **ID管理**: 自動採番によるユニークID生成
- **特殊対応**: `event.json` は `{"events": [...]}` 構造

## 3. 機能要件

### 3.1 ダッシュボード機能
**ファイル**: `frontend/modules/dashboard.py`

#### 機能概要
- システムのメイン画面として各種情報の概要表示
- 緊急災害情報の表示
- 新着回覧板情報の一覧表示
- 今後のイベント予定表示

#### 詳細仕様
- 未読回覧板のタイトル一覧表示
- 回覧板詳細ページへの遷移ボタン
- 固定の緊急情報表示エリア
- イベント詳細ページへの遷移機能

### 3.2 イベントカレンダー機能
**ファイル**: `frontend/modules/event_calendar.py`
**データファイル**: `backend/app/db/event.json`

#### 機能概要
- 町内イベントの表示・管理
- カレンダー形式でのイベント表示
- イベント参加申込機能

#### 詳細仕様
- **カレンダー表示**
  - streamlit-calendar ライブラリ使用
  - 週表示（朝7時〜夜7時）
  - 日付選択によるイベント絞り込み

- **イベント情報表示**
  - タイトル、開始・終了時刻、詳細説明
  - 該当日のイベント一覧表示

- **参加申込**
  - ポップオーバー形式のフォーム
  - 氏名、参加人数、備考欄の入力
  - 申込完了メッセージ表示

#### データ構造
```json
{
  "events": [
    {
      "id": 1,
      "title": "イベント名",
      "start": "2025-05-20T15:00:00",
      "end": "2025-05-20T17:00:00",
      "details": "イベント詳細",
      "added": "2025-05-10"
    }
  ]
}
```

### 3.3 回覧板機能
**ファイル**: `frontend/modules/kairanban.py`
**データファイル**: `backend/app/db/kairanban.json`

#### 機能概要
- 町内への連絡事項の回覧
- 住民による確認状況の管理

#### 詳細仕様
- **回覧板表示**
  - 未確認の回覧板のみ表示
  - タイトル、日付、内容の表示
  - HTML形式でのスタイル適用

- **確認機能**
  - チェックボックスによる確認状態の変更
  - 確認後の自動再表示

#### データ構造
```json
[
  {
    "id": 1,
    "title": "回覧板タイトル",
    "date": "2025-05-10T10:00:00",
    "detail": "回覧内容",
    "editor": "管理者",
    "checked": false
  }
]
```

### 3.4 備蓄一覧機能
**ファイル**: `frontend/modules/stock_list.py`
**データファイル**: `backend/app/db/stock_data.json`

#### 機能概要
- 災害用備蓄品の在庫管理
- 消費期限の監視・警告

#### 詳細仕様
- **在庫表示**
  - pandas DataFrame によるテーブル表示
  - 物品名、数量、消費期限、残り日数、保管場所

- **期限警告**
  - 消費期限30日以下の品目を赤字表示
  - 残り日数の自動計算

#### データ構造
```json
[
  {
    "id": 1,
    "品名": "物品名",
    "数量": 100,
    "消費期限": "2025-12-31",
    "格納場所": "倉庫A"
  }
]
```

### 3.5 収支報告機能
**ファイル**: `frontend/modules/financial_report.py`

#### 機能概要
- 町内会費の収支状況の可視化
- 月別収支データの表示・分析

#### 詳細仕様
- **データ表示**
  - 過去12ヶ月の月別収支データ
  - 収入、支出、月次収支、残高の表示

- **グラフ表示**
  - 収入・支出推移の折れ線グラフ
  - 残高推移グラフ
  - 支出内訳の棒グラフ

- **支出分析**
  - 月選択による支出内訳表示
  - カテゴリ別支出の可視化

### 3.6 議事録機能
**ファイル**: `frontend/modules/meeting.py`
**データファイル**: `backend/app/db/minutes.json`

#### 機能概要
- 会議議事録の管理・閲覧
- 音声ファイルからの議事録生成（将来機能）

#### 詳細仕様
- **議事録閲覧**
  - セレクトボックスによる議事録選択
  - 議事録内容の表示

- **音声処理**
  - 音声ファイルアップロード機能
  - AI要約生成のインターフェース（未実装）

#### データ構造
```json
[
  {
    "id": 1,
    "タイトル": "議事録タイトル",
    "内容": "議事録内容",
    "作成日": "2025-05-10 14:30"
  }
]
```

### 3.7 チャット機能
**ファイル**: `frontend/modules/chat.py`

#### 機能概要
- コミュニティ内での対話機能（デモ版）

#### 詳細仕様
- **チャットインターフェース**
  - st.chat_input による入力
  - st.chat_message による表示
  - セッションステートでの履歴管理

- **AI応答**
  - ダミー応答のランダム選択
  - 実際のAI統合のための基盤

### 3.8 管理者機能
**ファイル**: `frontend/modules/admin.py`

#### 機能概要
- 全データの CRUD 操作
- システム全体の管理機能

#### 詳細仕様
- **認証機能**
  - パスワード認証
  - セッション管理

- **データ管理**
  - 回覧板の作成・編集・削除
  - イベントの追加・編集・削除
  - 備蓄品の登録・編集・削除
  - 議事録の作成・編集・削除
  - 会計情報の登録・編集・削除

- **UI構成**
  - エクスパンダー形式での機能分類
  - フォームベースの操作インターフェース

## 4. 非機能要件

### 4.1 ユーザビリティ
- 直感的なサイドバーナビゲーション
- 日本語での操作インターフェース
- レスポンシブデザイン（Streamlit標準）

### 4.2 パフォーマンス
- JSONファイルベースでの高速アクセス
- セッションステートによる状態管理
- 自動リロード機能

### 4.3 セキュリティ
- 管理者機能への認証機能
- パスワード保護
- ファイルベースアクセス制御

### 4.4 保守性
- モジュール化されたページ構成
- 統一された CRUD 操作関数
- 設定ファイルでの環境管理

## 5. データファイル一覧

| ファイル名 | 用途 | 構造 |
|------------|------|------|
| `event.json` | イベント情報 | `{"events": [...]}` |
| `kairanban.json` | 回覧板情報 | `[...]` |
| `stock_data.json` | 備蓄品情報 | `[...]` |
| `minutes.json` | 議事録情報 | `[...]` |
| `finances.json` | 会計情報 | `[...]` |
| `boards.json` | 掲示板情報 | `[...]` |

## 6. 開発・運用要件

### 6.1 開発環境
- Python 3.8+
- rye パッケージマネージャー
- 主要依存関係: streamlit, streamlit-calendar, pandas, matplotlib

### 6.2 実行方法
```bash
# 依存関係インストール
rye sync

# アプリケーション起動
streamlit run frontend/app.py
```

### 6.3 ディレクトリ構成
```
regional-symb/
├── frontend/
│   ├── app.py              # メインアプリケーション
│   └── modules/            # 機能別モジュール
├── backend/
│   └── app/
│       └── db/            # JSONデータファイル
└── src/
    └── regional_symb/     # パッケージ
```

## 7. 今後の拡張予定

### 7.1 技術的拡張
- 実際のAI統合（音声認識・要約生成）
- データベース移行（PostgreSQL/MySQL）
- API化（FastAPI/Flask）

### 7.2 機能的拡張
- 通知機能
- モバイルアプリ対応
- 多言語対応
- データ分析機能の強化